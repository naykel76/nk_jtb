@use 'sass:list';
@use '../maps_and_variables/config' as *;
@use '../mixins/media-container-queries' as *;
@use '../mixins/build-system/make-properties' as *;
@use '../mixins/magic-shared' as *;
@use 'sass:map';

// ============================================================================
// Physical Position Map DEPRECATED
// ============================================================================
// Maps position keys to physical CSS properties (top, left, etc.).
// Used for absolute/fixed positioning utilities that don't need logical properties.
// ============================================================================
// prettier-ignore
$axis-position-map: (
    xy: (top, bottom, left, right),
    x: (left, right),
    y: (top, bottom),
    t: top,
    b: bottom,
    l: left,
    r: right
) !default;


// ============================================================================
// Property handler for value and position combinations
// ============================================================================
// If `$positions` is empty or falsey, applies a single property.
// If `$positions` is a direction map (e.g. `x` or `y`), uses directional mixin.
// Always appends unit to value (default is `rem`).
// ============================================================================
@mixin handle-magic-properties($property, $value, $positions, $unit: rem) {
    @if $positions == '' or not $positions {
        @include make-property($property, #{$value}#{$unit});
    } @else {
        @include make-position-properties($property, $value, $positions);
    }
}

// ============================================================================
// Generate utility classes with breakpoint support
// ============================================================================
// Generates a class for each list of values in `$values-list`, assigning a
// value per breakpoint tier: base, sm, md, lg, xl.
// Supports optional axis-based property maps (e.g. `margin-x` → `left/right`).
// Can apply to child elements if `$is-parent` is true.
// ----------------------------------------------------------------------------
// Example:
//   $values-list: ((5, 3, 2), (4, 2))
//   → Outputs: .gap-2-3-5, .gap-2-4, with responsive styles
// ----------------------------------------------------------------------------
@mixin build-magic-classes(
    $property,
    $values-list,
    $identifier,
    $unit: 'rem',
    $position-or-axis: '',
    $is-parent: false
) {
    $positions: map.get($axis-position-map, $position-or-axis);

    @each $list in $values-list {
        @if $list != () {
            $bp-values: get-breakpoint-values($list);
            $num-breakpoints: list.length($list);
            $class-base: derived-class($list, $identifier);

            @if $is-parent {
                .c-#{$class-base} > * {
                    @include handle-magic-properties($property, map.get($bp-values, base), $positions);

                    @include from-sm {
                        @include handle-magic-properties($property, map.get($bp-values, sm), $positions);
                    }

                    @if $num-breakpoints >= 3 {
                        @include from-md {
                            @include handle-magic-properties($property, map.get($bp-values, md), $positions);
                        }
                    }

                    @if $num-breakpoints >= 4 {
                        @include from-lg {
                            @include handle-magic-properties($property, map.get($bp-values, lg), $positions);
                        }
                    }

                    @if $num-breakpoints >= 5 {
                        @include from-xl {
                            @include handle-magic-properties($property, map.get($bp-values, xl), $positions);
                        }
                    }
                }
            } @else {
                .#{$class-base} {
                    @include handle-magic-properties($property, map.get($bp-values, base), $positions);

                    @include from-sm {
                        @include handle-magic-properties($property, map.get($bp-values, sm), $positions);
                    }

                    @if $num-breakpoints >= 3 {
                        @include from-md {
                            @include handle-magic-properties($property, map.get($bp-values, md), $positions);
                        }
                    }

                    @if $num-breakpoints >= 4 {
                        @include from-lg {
                            @include handle-magic-properties($property, map.get($bp-values, lg), $positions);
                        }
                    }

                    @if $num-breakpoints >= 5 {
                        @include from-xl {
                            @include handle-magic-properties($property, map.get($bp-values, xl), $positions);
                        }
                    }
                }
            }
        }
    }
}
