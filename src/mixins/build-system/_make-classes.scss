@use '../../functions/classes' as *;
@use './helpers' as *;
@use './make-properties' as *;
@use './breakpoint-handlers' as *;
@use 'sass:map';
@use 'sass:meta';


// ============================================================================
// Layer 1: Base only
// ============================================================================
@mixin make-base-class($property, $class, $value, $positions: null, $options: ()) {
    $child-selector: if(map.has-key($options, 'child-selector'), map.get($options, 'child-selector'), false);

    @if $positions {
        $prefix: map.get($options, 'prefix');
        $variant: map.get($options, 'variant');
        $omit-axis-keys: if(map.has-key($options, 'omit-axis-keys'), map.get($options, 'omit-axis-keys'), false);

        @each $position-key, $position-list in $positions {
            $derived-class: build-position-class-name($prefix, $variant, $position-key, $omit-axis-keys);
            $props: build-property-map($property, $position-list, $value, meta.get-function('get-position-property'));
            #{build-selector($derived-class, $child-selector)} {
                @include make-properties($props);
            }
        }
    } @else {
        #{build-selector($class, $child-selector)} {
            #{$property}: $value;
        }
    }
}

// ============================================================================
// Layer 2: Responsive only (no base, no states)
// ============================================================================
@mixin make-responsive-class($property, $class, $value, $positions: null, $breakpoints, $options: ()) {
    $child-selector: if(map.has-key($options, 'child-selector'), map.get($options, 'child-selector'), false);

    @each $bp in $breakpoints {
        $derived-class: #{$bp}\:#{$class};

        #{build-selector($derived-class, $child-selector)} {
            @include from-breakpoint($bp) {
                @if $positions {
                    $props: build-property-map($property, $positions, $value, meta.get-function('get-position-property'));

                    @include make-properties($props);
                } @else {
                    #{$property}: $value;
                }
            }
        }
    }
}

// ============================================================================
// Layer 3: States only (no base, no responsive)
// Generates: .hover:block:hover { display: block; }
// ============================================================================
@mixin make-state-class($property, $class, $value, $states, $options: ()) {
    @each $state in $states {
        .#{$state}\:#{$class}:#{$state} {
            #{$property}: $value;
        }
    }
}

// ============================================================================
// Layer 4: Responsive + State (no base, no solo variants)
// Generates: .md:hover:block:hover { @media (min-width: 768px) { display: block; } }
// ============================================================================
@mixin make-responsive-state-class($property, $class, $value, $breakpoints, $states, $options: ()) {
    $child-selector: if(map.has-key($options, 'child-selector'), map.get($options, 'child-selector'), false);

    @each $bp in $breakpoints {
        @each $state in $states {
            $derived-class: #{$bp}\:#{$state}\:#{$class};

            #{build-selector($derived-class, $child-selector)} {
                @include from-breakpoint($bp) {
                    &:#{$state} {
                        #{$property}: $value;
                    }
                }
            }
        }
    }
}

// ============================================================================
// Composite classes - multi-property utilities
// Generates: .p-ctrl { padding-block: ...; padding-inline: ...; }
// ============================================================================
@mixin make-composite-class($class, $props, $breakpoints: null, $child-selector: false) {
    #{build-selector($class, $child-selector)} {
        @include make-properties($props);
    }

    @if $breakpoints {
        @each $bp in $breakpoints {
            $derived-class: #{$bp}\:#{$class};

            #{build-selector($derived-class, $child-selector)} {
                @include from-breakpoint($bp) {
                    @include make-properties($props);
                }
            }
        }
    }
}
