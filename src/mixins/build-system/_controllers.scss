@use './layers' as *;
@use './normalise-config' as *;
@use 'sass:map';

// ============================================================================
// Controller: Base classes only
// ============================================================================
@mixin build-base-classes($properties-map, $responsive: false, $with-state: false) {
    @each $property, $config in $properties-map {
        $normalised: normalise-config($property, $config, $responsive, $with-state);

        // Layer 1: Base classes
        @include build-base-layer($normalised);
    }
}

// ============================================================================
// Controller: Responsive classes only
// ============================================================================
@mixin build-responsive-classes($properties-map, $responsive: true, $with-state: false) {
    @each $property, $config in $properties-map {
        $normalised: normalise-config($property, $config, $responsive, $with-state);

        // Layer 2: Responsive variants
        @if map.get($normalised, 'breakpoints') {
            @include build-responsive-layer($normalised);
        }
    }
}

// ============================================================================
// Controller: State classes only
// ============================================================================
@mixin build-state-classes($properties-map, $with-state: true) {
    @each $property, $config in $properties-map {
        $normalised: normalise-config($property, $config, false, $with-state);

        // Layer 3: State variants
        @if map.get($normalised, 'states') {
            @include build-state-layer($normalised);
        }
    }
}

// ============================================================================
// Controller: Grand unified - Base + Responsive
// ============================================================================
@mixin build-classes($properties-map, $responsive: false, $with-state: false) {
    @each $property, $config in $properties-map {
        $normalised: normalise-config($property, $config, $responsive, $with-state);

        // Layer 1: Base classes
        @include build-base-layer($normalised);

        // Layer 2: Responsive variants
        @if map.get($normalised, 'breakpoints') {
            @include build-responsive-layer($normalised);
        }
        
        // Layer 3: State variants
        @if map.get($normalised, 'states') {
            @include build-state-layer($normalised);
        }
        
        // Layer 4: Responsive + State
        @if map.get($normalised, 'breakpoints') and map.get($normalised, 'states') {
            @include build-responsive-state-layer($normalised);
        }
    }
}

// ============================================================================
// Controller: Composite classes - multi-property utilities
// ============================================================================
@mixin build-composite-classes($properties-map, $responsive: false) {
    @include build-composite-layer($properties-map, $responsive);
}