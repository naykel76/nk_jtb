// @use './utilities/border' as *;
@use './common-tools' as *;
@use './functions/resolvers' as *;
@use './maps_and_variables/colors' as *;
@use './mixins/build-magic-grid' as *;
@use './mixins/make-classes-old' as *;
@use './mixins/make-classes' as *;
@use './mixins/transition' as *;
@use 'sass:color';
@use 'sass:list';
@use 'sass:map';
@use 'sass:string';
@use 'sass:meta';

// ============================================================================
$property: 'margin';
$class: 'm-5';
$value: 5rem;
$options: (child-selector: true); // optional

@include make-base-variant($property, $class, $value);
@include make-base-variant($property, $class, $value, $options);

// ============================================================================

// Core builder - orchestrates the layers (think of it like a controller)
@mixin build-classes-new($properties-map, $responsive: false, $with-state: false, $debug: false) {
    @each $property, $config in $properties-map {
        $normalised: normalise-property-config($property, $config, $responsive, $with-state);

        // Layer 1: Base classes (no breakpoints, no states)
        @include build-base-classes($normalised);

        // Layer 2: Responsive variants (breakpoints only, no base, no states)
        @if map.get($normalised, 'breakpoints') {
            @include build-responsive-layer($normalised);
        }

        // // Layer 3: State variants (states only)
        // @if map.get($normalised, 'states') {
        //     @include build-state-layer($normalised);
        // }

        // // Layer 4: Responsive + State combinations
        // @if map.get($normalised, 'breakpoints') and map.get($normalised, 'states') {
        //     @include build-responsive-state-layer($normalised);
        // }

        // ====================================================================
        // Debug
        // ====================================================================
        @if $debug {
            .normalised-property-values {
                content: 'Property:' map.get($normalised, 'property');
                content: 'Prefix:' map.get($normalised, 'prefix');
                content: 'Breakpoints:' map.get($normalised, 'breakpoints');
                content: 'States:' map.get($normalised, 'states');
                content: 'Positions:' map.get($normalised, 'positions');
                content: 'Omit Axis Keys:' map.get($normalised, 'omit-axis-keys');
                content: 'Child Combinator:' map.get($normalised, 'child-combinator');
            }

            @debug '=== #{$property} ===';
            @debug "Property: #{map.get($normalised, 'property')}";
            @debug "Prefix: #{map.get($normalised, 'prefix')}";
            @debug "Breakpoints: #{meta.inspect(map.get($normalised, 'breakpoints'))}";
            @debug "States: #{meta.inspect(map.get($normalised, 'states'))}";
            @debug "Items: #{meta.inspect(map.get($normalised, 'items'))}";
            @debug '';
        }
    }
}

$display-visibility-properties-map: (
    display: (
        prefix: false,
        values: $display,
        states: hover
    ),
    height: (
        prefix: 'h-',
        values: (
            1,
            2,
            3
        ),
        unit: 'rem'
    ),
    // visibility: (
    //     prefix: false,
    //     values: $visibility,
    //     states: hover
     // )
);

// @include build-classes-new($display-visibility-properties-map, $responsive: true);
