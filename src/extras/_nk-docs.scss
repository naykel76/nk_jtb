/* stylelint-disable selector-type-no-unknown */
@use '../functions/map-and-list-helpers' as *;
@use '../maps_and_variables/base' as *;
@use '../maps_and_variables/colors' as *;
@use '../mixins/backgrounds' as *;
@use '../mixins/breakpoint-utilities' as *;
@use '../mixins/build-system/controllers' as *;
@use 'sass:map';

$question-color: #c40c9a !default;

// ============================================================================
// -- Layouts --
// ============================================================================
.nk-docs {
    background-color: var(--bg-body);
    display: flex;

    h2 {
        color: var(--primary);
        font-size: 1.25rem;
        margin-block-start: 4rem;
    }

    h2 + p {
        margin-block-start: 0.5rem;
    }

    h3 {
        font-size: 1.5rem;
        margin-block-start: 1rem;
    }

    :is(.left-sidebar, .right-sidebar) {
        background-color: var(--bg-surface);
        flex-shrink: 0;
        padding: $base-padding;
        width: 16rem;
    }

    .left-sidebar {
        border-right: 1px solid var(--border-color);
        height: 100vh;
        left: 0;
        overflow-y: auto;
        position: sticky;
        top: 0;
    }

    .right-sidebar {
        border-left: 1px solid var(--border-color);
    }

    /* Add this for your main content area */
    .main-content {
        /* This is the key fix! */
        flex: 1;

        /* or whatever class wraps your markdown */
        min-width: 0;

        /* Allow it to grow and fill space */
    }

    .toc {
        font-size: 0.875rem;
        position: sticky;
        top: 1rem;
    }
}

:is(h1, h2, h3, h4, h5, h6, question) {
    code {
        font-size: inherit;
    }
}

[class^='example'] {
    border: 2px solid;
    border-radius: 0.5rem;
    padding: 1rem;
}

.example {
    &-jtb {
        background: repeating-linear-gradient(
            135deg,
            rgb(252 231 243 / 20%),
            rgb(252 231 243 / 20%) 20px,
            rgb(249 168 212 / 20%) 20px,
            rgb(249 168 212 / 20%) 40px
        );
        border-color: map.get($oklch-colors, 'pink-500');
        border-width: 3px;
    }

    &-utils {
        background: repeating-linear-gradient(
            135deg,
            rgb(219 234 254 / 20%),
            rgb(219 234 254 / 20%) 20px,
            rgb(147 197 253 / 20%) 20px,
            rgb(147 197 253 / 20%) 40px
        );
        border-color: map.get($oklch-colors, 'blue-500');
        border-width: 3px;

        // @include bg-stripes('blue', 5px);
    }
}

// used for svg icon backgrounds in docs
.svg-icon {
    &-pink {
        border: 1px solid map.get($oklch-colors, 'pink-500');

        @include bg-stripes('pink');
    }

    &-blue {
        border: 1px solid map.get($oklch-colors, 'blue-500');

        @include bg-stripes('blue');
    }
}

// ============================================================================
// -- Custom Selectors --
// ============================================================================
// special styling for <question> elements in docs
question {
    color: var(--text-question-color, $question-color);
    font-size: 1.15rem;
    font-style: italic;
    font-weight: 700;
    margin-block-start: $base-gap;
}

discuss {
    background-color: var(--purple-50);
    border: 3px dashed var(--purple-400);
    border-radius: 0.5rem;
    color: var(--purple-900);
    display: block;
    font-size: 1.15rem;
    margin-block-start: $base-gap;
    padding: 1.25rem;
}

// ============================================================================
// -- Torchlight Code Highlighting --
// ============================================================================

pre code.torchlight {
    display: block;
    min-width: max-content;

    // .line { padding-inline: 1rem; }

    .line-number,
    .summary-caret {
        margin-inline-end: 1rem;
    }
}

/* Focus behaviour */
.torchlight {
    &.has-focus-lines {
        .line:not(.line-focus) {
            filter: blur(0.095rem);
            opacity: 0.65;
            transition:
                filter 0.35s,
                opacity 0.35s;
        }

        &:hover .line:not(.line-focus) {
            filter: blur(0);
            opacity: 1;
        }
    }

    summary:focus {
        outline: none;
    }

    details {
        > summary {
            &::marker,
            &::-webkit-details-marker {
                display: none;
            }
        }

        .summary-caret::after {
            pointer-events: none;
        }

        .summary-caret-start::after {
            color: yellow;
            content: '+';
        }

        &[open] .summary-caret-start::after {
            content: '-';
        }

        .summary-caret-middle::after,
        .summary-caret-end::after,
        .summary-caret-empty::after {
            content: ' ';
        }

        .summary-hide-when-open {
            color: yellow !important;
        }

        &[open] .summary-hide-when-open {
            display: none;
        }

        &:not([open]) .summary-hide-when-open {
            display: initial;
        }
    }
}

// ============================================================================
// -- Container Queries --
// ============================================================================
:where(.resizable-container) {
    border: 2px dashed var(--primary);
    border-radius: 0.5rem;
    container-name: demo-container;
    container-type: inline-size;
    margin: 1rem 2rem;
    max-width: 100%;
    overflow: auto;
    padding: 1rem;
    position: relative;
    resize: horizontal;

    &::after {
        bottom: 0.1125;
        color: #667eea;
        content: '← Drag to resize →';
        font-size: 0.75rem;
        pointer-events: none;
        position: absolute;
        right: 0.5rem;
    }
}

// prettier-ignore
@include cq-make-on-breakpoint((visibility: hidden), 'invisible', $responsive-variants );

// prettier-ignore
@include cq-make-on-breakpoint((visibility: visible), 'visible', $responsive-variants );

// prettier-ignore
@include cq-make-from-breakpoint((visibility: hidden), 'invisible', $responsive-variants );

// prettier-ignore
@include cq-make-from-breakpoint((visibility: visible), 'visible', $responsive-variants );

// prettier-ignore
@include cq-make-to-breakpoint((visibility: hidden), 'invisible', remove-from-list($responsive-variants, xxl));

// prettier-ignore
@include cq-make-to-breakpoint((visibility: visible), 'visible', remove-from-list($responsive-variants, xxl));
